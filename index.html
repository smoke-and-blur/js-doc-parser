<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="manifest" href="pwa.json" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
    const registerServiceWorker = async () => {
        if ("serviceWorker" in navigator) {
            try {
                const registration = await navigator.serviceWorker.register("/service-worker.js", {
                    scope: "/",
                });
                if (registration.installing) {
                    console.log("Service worker installing");
                } else if (registration.waiting) {
                    console.log("Service worker installed");
                } else if (registration.active) {
                    console.log("Service worker active");
                }
            } catch (error) {
                console.error(`Registration failed with ${error}`);
            }
        }
    };

    registerServiceWorker();
</script>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        text-wrap: wrap;
    }

    img {
        max-width: 240px;
        border-radius: 16px;
        display: block;
    }

    .section {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .container {
        margin: auto;
        display: flex;
        flex-direction: column;
        gap: 16px;
        max-width: 800px;
    }

    form {
        grid-column: span 2;
    }

    body {
        padding: 16px;
    }
</style>



<div class="container">
    <form id="form" action="https://go-doc-parser.onrender.com" method="POST">
        <input id="files" type="file" multiple>
        <input type="submit">
    </form>
    <details>
        <summary>Для роботи на Android та PC</summary>
        <div class="section">
            <p>1. Додати цю сторінку як застосунок <b>Doc Parser</b> на робочий стіл</p>
            <p>2. Поділитися одним або декількома DOCX-файлами з цим застосунком</p>
            <img src="manual/android-installation-1.png">
            <img src="manual/android-installation-2.png">
            <img src="manual/android-1.png">
            <img src="manual/android-2.png">
        </div>
    </details>
    <details>
        <summary>Для роботи на iPhone</summary>
        <div class="section">
            <p>1. Переконатися, що встановлено застосунок <a
                    href="https://apps.apple.com/us/app/shortcuts/id915249334">Shortcuts</a></p>
            <p>2. Завантажити <a href="shortcuts/Parse Flights.shortcut">Shortcut</a> <b>Flight Parser</b></p>
            <p>3. Поділитися одним або декількома DOCX-файлами через цей Shortcut</p>
            <img src="manual/ios-1.png">
            <img src="manual/ios-2.png">
            <img src="manual/ios-3.png">
            <img src="manual/ios-4.png">
        </div>
    </details>
    <details>
        <summary>Для роботи через cURL</summary>
        <div class="section">
            <p>1. Запакувати документи у ZIP-архів</p>
            <p>2. Надіслати архів до серверу для обробки та зберегти результат у вигляді HTML-сторінки</p>
            <pre>curl https://go-doc-parser.onrender.com -F "in=@documents.zip" > out.html</pre>
        </div>
    </details>
</div>

<!-- <script>
    form = document.getElementById('form')
    form.attachEvent("submit", (e) => {
        e.preventDefault();
    })
</script> -->

<script>
    const form = document.getElementById("form");
    const fileInput = document.getElementById("files");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!fileInput.files.length) {
            alert("Please choose at least one file");
            return;
        }

        // Zip selected files
        const zip = new JSZip();
        for (const file of fileInput.files) {
            zip.file(file.name, file);
        }
        const blob = await zip.generateAsync({ type: "blob" });

        // Build a FormData for the upload
        const formData = new FormData();
        formData.append("file", blob, "upload.zip");

        // Build a temporary <form> with a hidden file input (Blob -> File)
        const tmpForm = document.createElement("form");
        tmpForm.method = "POST";
        tmpForm.action = form.action;
        tmpForm.enctype = "multipart/form-data";
        tmpForm.style.display = 'none'

        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(new File([blob], "upload.zip"));
        const hiddenInput = document.createElement("input");
        hiddenInput.type = "file";
        hiddenInput.name = "file";
        hiddenInput.files = dataTransfer.files;
        tmpForm.appendChild(hiddenInput);

        document.body.appendChild(tmpForm);
        tmpForm.submit(); // triggers a real navigation
    });
</script>